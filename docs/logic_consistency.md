# ì¶”ì²œ/ë°±í…ŒìŠ¤íŠ¸ ë¡œì§ ì¼ê´€ì„± ê°€ì´ë“œ

> **ì¤‘ìš”:** ì¶”ì²œê³¼ ë°±í…ŒìŠ¤íŠ¸ëŠ” ë™ì¼í•œ ë§¤ë§¤ ë¡œì§ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. í•œ ìª½ì„ ìˆ˜ì •í•  ë•Œ ë°˜ë“œì‹œ ë‹¤ë¥¸ ìª½ë„ í™•ì¸í•˜ì„¸ìš”.

## ğŸ“‚ íŒŒì¼ ë§¤í•‘

| ì¶”ì²œ (Recommend) | ë°±í…ŒìŠ¤íŠ¸ (Backtest) | ì—­í•  |
|-----------------|-------------------|------|
| `logic/recommend/portfolio.py` | `logic/backtest/portfolio_runner.py` | ë§¤ë§¤ ì˜ì‚¬ê²°ì • ë¡œì§ |
| `logic/recommend/pipeline.py` | `logic/backtest/account_runner.py` | ë°ì´í„° ì¤€ë¹„ ë° ì‹¤í–‰ |

---

## âœ… ë™ì¼í•´ì•¼ í•˜ëŠ” í•µì‹¬ ë¡œì§ (7ê°œ)

### 1. ë§¤ë„ ì¡°ê±´ íŒë‹¨ ìˆœì„œ

**ìš°ì„ ìˆœìœ„:** CUT_STOPLOSS â†’ SELL_RSI â†’ SELL_TREND

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ìœ„ì¹˜ | 190-198ì¤„ | 663-668ì¤„ |

**ì¡°ê±´:**
- **CUT_STOPLOSS:** `holding_return_pct <= stop_loss_threshold`
- **SELL_RSI:** `rsi_score <= rsi_sell_threshold`
- **SELL_TREND:** `current_price < ma_value`

**ì½”ë“œ ì˜ˆì‹œ:**
```python
# ì†ì ˆ ì²´í¬
if holding_return_pct <= stop_loss_threshold:
    decision = "CUT_STOPLOSS"
# RSI ê³¼ë§¤ìˆ˜ ì²´í¬
elif rsi_score <= rsi_sell_threshold:
    decision = "SELL_RSI"
# ì¶”ì„¸ ì´íƒˆ ì²´í¬
elif current_price < ma_value:
    decision = "SELL_TREND"
```

---

### 2. ì¿¨ë‹¤ìš´ ë¡œì§

**ê·œì¹™:** `days_since < cooldown_days` â†’ ê±°ë˜ ì°¨ë‹¨

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ë§¤ìˆ˜ í›„ ë§¤ë„ ì¿¨ë‹¤ìš´ | 63-111ì¤„ (`_calculate_cooldown_blocks`) | 654ì¤„ (`sell_block_until`) |
| ë§¤ë„ í›„ ë§¤ìˆ˜ ì¿¨ë‹¤ìš´ | 63-111ì¤„ (`_calculate_cooldown_blocks`) | 768ì¤„ (`buy_block_until`) |

**COOLDOWN_DAYS=1 ì˜ë¯¸:**
- **ë‹¹ì¼ (0ì¼):** ë°˜ëŒ€ ê±°ë˜ ì°¨ë‹¨
- **ë‹¤ìŒë‚  (1ì¼ ì´ìƒ):** ë°˜ëŒ€ ê±°ë˜ í—ˆìš©

**êµ¬í˜„ ì°¨ì´ (ê²°ê³¼ëŠ” ë™ì¼):**
- **ì¶”ì²œ:** ë§¤ë„ ê²°ì • í›„ ì¿¨ë‹¤ìš´ ì²´í¬ â†’ HOLDë¡œ ì „í™˜
- **ë°±í…ŒìŠ¤íŠ¸:** ë§¤ë„ ì „ ì¿¨ë‹¤ìš´ ì‚¬ì „ ì²´í¬ â†’ ë§¤ë„ ë¡œì§ ì§„ì… ì•ˆ í•¨

---

### 3. SELL_RSI ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨

**ê·œì¹™:** RSI ê³¼ë§¤ìˆ˜ë¡œ ë§¤ë„ë˜ëŠ” ì¹´í…Œê³ ë¦¬ëŠ” ê°™ì€ ë‚  ë§¤ìˆ˜ ê¸ˆì§€

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ìœ„ì¹˜ | 484-491ì¤„ | 696-699ì¤„ |

**ë™ì‘:**
1. SELL_RSI ìƒíƒœì¸ ì¢…ëª©ì˜ ì¹´í…Œê³ ë¦¬ë¥¼ `sell_rsi_categories_today`ì— ì¶”ê°€
2. ê°™ì€ ë‚  í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë‹¤ë¥¸ ì¢…ëª© ë§¤ìˆ˜ ì°¨ë‹¨

**ì˜ˆì‹œ:**
```python
# 442580 (ë¯¸êµ­ë°˜ë„ì²´) SELL_RSI
# â†’ "ë¯¸êµ­ë°˜ë„ì²´" ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨
# â†’ 446770 (ë¯¸êµ­ë°˜ë„ì²´) ë§¤ìˆ˜ ë¶ˆê°€
```

---

### 4. RSI ê³¼ë§¤ìˆ˜ ê²½ê³  ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨ â­

**ê·œì¹™:** ì¿¨ë‹¤ìš´ìœ¼ë¡œ ì•„ì§ ë§¤ë„í•˜ì§€ ëª»í–ˆì§€ë§Œ RSI ê³¼ë§¤ìˆ˜ì¸ ì¢…ëª©ì˜ ì¹´í…Œê³ ë¦¬ë„ ì°¨ë‹¨

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ìœ„ì¹˜ | 493-499ì¤„ | 436-445ì¤„ |

**ë™ì‘:**
1. ë³´ìœ  ì¤‘ì¸ ì¢…ëª©ì˜ RSIê°€ ê³¼ë§¤ìˆ˜ ì„ê³„ê°’ ì´í•˜ì¸ì§€ ì²´í¬
2. ì¿¨ë‹¤ìš´ ë•Œë¬¸ì— ì•„ì§ ë§¤ë„í•˜ì§€ ëª»í•œ ê²½ìš°ì—ë„ ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨
3. ê°™ì€ ë‚  í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë‹¤ë¥¸ ì¢…ëª© ë§¤ìˆ˜ ì°¨ë‹¨

**ì˜ˆì‹œ:**
```python
# 457990 (íƒœì–‘ê´‘) ë³´ìœ ì¼ 0ì¼, RSI 14
# â†’ ì¿¨ë‹¤ìš´ìœ¼ë¡œ ë§¤ë„ ë¶ˆê°€
# â†’ "íƒœì–‘ê´‘" ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨
# â†’ ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‹¤ë¥¸ ì¢…ëª© ë§¤ìˆ˜ ë¶ˆê°€
```

---

### 5. í•µì‹¬ ë³´ìœ  ì¢…ëª© (CORE_HOLDINGS)

**ê·œì¹™:**
- ë§¤ë„ ì‹ í˜¸ ë¬´ì‹œ (ê°•ì œ HOLD_CORE)
- ë¯¸ë³´ìœ  ì‹œ ìë™ ë§¤ìˆ˜
- TOPNì— í¬í•¨

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ë§¤ë„ ë¬´ì‹œ | 400-414ì¤„ | 670-672ì¤„ |
| ìë™ ë§¤ìˆ˜ | 416-454ì¤„ | 734-759ì¤„ |

**ë™ì‘:**
```python
# í•µì‹¬ ë³´ìœ  ì¢…ëª©ì€ SELL_RSI, SELL_TREND ë“± ëª¨ë“  ë§¤ë„ ì‹ í˜¸ ë¬´ì‹œ
if ticker in core_holdings:
    if decision in {"SELL_TREND", "SELL_RSI", "CUT_STOPLOSS"}:
        decision = "HOLD_CORE"
```

---

### 6. ì‹œì¥ ë ˆì§ í•„í„°

**ê·œì¹™:**
- ë¦¬ìŠ¤í¬ ì˜¤í”„ ì‹œ ë§¤ìˆ˜ ì¤‘ë‹¨ ë˜ëŠ” ì¶•ì†Œ
- ë§¤ë„ëŠ” í•­ìƒ í™œì„±í™” (RSI ê³¼ë§¤ìˆ˜ ë§¤ë„ í¬í•¨)

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py` | `portfolio_runner.py` |
| ìœ„ì¹˜ | 458-473ì¤„ | 447-470ì¤„ |

**ì„¤ì •:**
- `MARKET_REGIME_RISK_OFF_EQUITY_RATIO`: ë¦¬ìŠ¤í¬ ì˜¤í”„ ì‹œ íˆ¬ì ë¹„ìœ¨ (0-100%)
  - 100: ì •ìƒ íˆ¬ì
  - 90: 90% íˆ¬ì (10% í˜„ê¸ˆ)
  - 0: ì „ëŸ‰ ë§¤ë„

---

### 7. ì¹´í…Œê³ ë¦¬ ì¤‘ë³µ ì œí•œ

**ê·œì¹™:** `MAX_PER_CATEGORY` ì„¤ì •ê°’ë§Œí¼ë§Œ ë³´ìœ 

| í•­ëª© | ì¶”ì²œ | ë°±í…ŒìŠ¤íŠ¸ |
|------|------|---------|
| íŒŒì¼ | `portfolio.py`, `pipeline.py` | `portfolio_runner.py` |
| ìœ„ì¹˜ | 334-342ì¤„, 1163-1166ì¤„ | 783-785ì¤„ |

**ë™ì‘:**
```python
# MAX_PER_CATEGORY = 1
# â†’ ê°™ì€ ì¹´í…Œê³ ë¦¬ ì¢…ëª©ì€ 1ê°œë§Œ ë³´ìœ  ê°€ëŠ¥
# â†’ ì´ë¯¸ ë³´ìœ  ì¤‘ì´ë©´ ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‹¤ë¥¸ ì¢…ëª© ë§¤ìˆ˜ ë¶ˆê°€
```

---

## ğŸ”§ ìˆ˜ì • ì‹œ ì ˆì°¨

### 1ë‹¨ê³„: ìˆ˜ì • ì „ í™•ì¸
- [ ] ìœ„ 7ê°œ ë¡œì§ ì¤‘ ì–´ë–¤ ê²ƒì„ ìˆ˜ì •í•˜ëŠ”ì§€ í™•ì¸
- [ ] í•´ë‹¹ ë¡œì§ì˜ íŒŒì¼ ë§¤í•‘ í™•ì¸ (ì¶”ì²œ â†” ë°±í…ŒìŠ¤íŠ¸)

### 2ë‹¨ê³„: ì–‘ìª½ ìˆ˜ì •
- [ ] ì¶”ì²œ íŒŒì¼ ìˆ˜ì •
- [ ] ë°±í…ŒìŠ¤íŠ¸ íŒŒì¼ë„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] ì½”ë“œ ë¹„êµ (ì¡°ê±´, ìˆœì„œ, ë¡œì§ ë™ì¼í•œì§€)

### 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸
```bash
# ì¶”ì²œ ì‹¤í–‰
python recommend.py k1

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python backtest.py k1

# íŠœë‹ ì‹¤í–‰ (ì„ íƒ)
python tune.py k1
```

### 4ë‹¨ê³„: ê²°ê³¼ ë¹„êµ
- [ ] ì¶”ì²œ ê²°ê³¼ í™•ì¸ (BUY, SELL, HOLD ìƒíƒœ)
- [ ] ë°±í…ŒìŠ¤íŠ¸ CAGR í™•ì¸
- [ ] ë¡œê·¸ì—ì„œ ì¿¨ë‹¤ìš´, RSI ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨ ë©”ì‹œì§€ í™•ì¸

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### êµ¬í˜„ ë°©ì‹ì€ ë‹¬ë¼ë„ ê²°ê³¼ëŠ” ë™ì¼í•´ì•¼ í•¨

**ì˜ˆì‹œ: ì¿¨ë‹¤ìš´ ì²´í¬**
- **ì¶”ì²œ:** ë§¤ë„ ê²°ì • í›„ ì¿¨ë‹¤ìš´ ì²´í¬ â†’ HOLDë¡œ ì „í™˜
- **ë°±í…ŒìŠ¤íŠ¸:** ë§¤ë„ ì „ ì¿¨ë‹¤ìš´ ì‚¬ì „ ì²´í¬ â†’ ë§¤ë„ ë¡œì§ ì§„ì… ì•ˆ í•¨
- **ê²°ê³¼:** ë‘˜ ë‹¤ ì¿¨ë‹¤ìš´ ê¸°ê°„ ë™ì•ˆ ë§¤ë„í•˜ì§€ ì•ŠìŒ âœ…

### ë°ì´í„° ì†ŒìŠ¤ ì°¨ì´ëŠ” ì •ìƒ

- **ì¶”ì²œ:** ì‹¤ì‹œê°„ ê°€ê²©, NAV, iNAV ê´´ë¦¬ìœ¨
- **ë°±í…ŒìŠ¤íŠ¸:** ê³¼ê±° OHLCV ë°ì´í„°, ìŠ¬ë¦¬í”¼ì§€ ì ìš©
- **ì´ìœ :** ëª©ì ì´ ë‹¤ë¦„ (ì‹¤ì‹œê°„ ì¶”ì²œ vs ê³¼ê±° ì‹œë®¬ë ˆì´ì…˜)

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½

**ë§¤ë„ ë¡œì§ ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 190-198ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 663-668ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] ìˆœì„œ í™•ì¸: CUT_STOPLOSS â†’ SELL_RSI â†’ SELL_TREND

**ì¿¨ë‹¤ìš´ ë¡œì§ ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 63-111ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 654ì¤„, 768ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] `days_since < cooldown_days` ì¡°ê±´ í™•ì¸

**RSI ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨ ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 484-499ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 436-445ì¤„, 696-699ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] `sell_rsi_categories_today` ë¡œì§ í™•ì¸

**í•µì‹¬ ë³´ìœ  ì¢…ëª© ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 400-454ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 670-672ì¤„, 734-759ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] ë§¤ë„ ë¬´ì‹œ + ìë™ ë§¤ìˆ˜ ë¡œì§ í™•ì¸

**ì‹œì¥ ë ˆì§ í•„í„° ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 458-473ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 447-470ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] `risk_off_equity_ratio` ì„¤ì • í™•ì¸

**ì¹´í…Œê³ ë¦¬ ì¤‘ë³µ ì œí•œ ìˆ˜ì • ì‹œ:**
- [ ] `portfolio.py` 334-342ì¤„, `pipeline.py` 1163-1166ì¤„ ìˆ˜ì •
- [ ] `portfolio_runner.py` 783-785ì¤„ ë™ì¼í•˜ê²Œ ìˆ˜ì •
- [ ] `MAX_PER_CATEGORY` ì„¤ì • í™•ì¸

---

## ğŸš€ í–¥í›„ ê°œì„  (ì„ íƒì‚¬í•­)

### ê³µí†µ í•¨ìˆ˜ ì¶”ì¶œ ê³ ë ¤ ì‹œì 

ë‹¤ìŒ ìƒí™©ì´ ë°œìƒí•˜ë©´ ê³µí†µí™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”:

1. **ë§¤ë„ ë¡œì§ì„ 3ë²ˆ ì´ìƒ ìˆ˜ì •í•´ì•¼ í•  ë•Œ**
2. **ìƒˆë¡œìš´ ì „ëµ(ì˜ˆ: MAPS2)ì„ ì¶”ê°€í•  ë•Œ**
3. **ë¡œì§ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ë²„ê·¸ê°€ ì‹¤ì œë¡œ ë°œìƒí–ˆì„ ë•Œ**

### ê³µí†µí™” í›„ë³´

1. **ë§¤ë„ ì¡°ê±´ íŒë‹¨ í•¨ìˆ˜**
   ```python
   # logic/common_decisions.py
   def determine_sell_decision(...) -> Optional[str]
   ```

2. **ì¿¨ë‹¤ìš´ ìƒíƒœ ê³„ì‚° í•¨ìˆ˜**
   ```python
   # strategies/maps/cooldown.py
   def calculate_cooldown_status(...) -> Dict[str, Any]
   ```

3. **SELL_RSI ì¹´í…Œê³ ë¦¬ ìˆ˜ì§‘ í•¨ìˆ˜**
   ```python
   # logic/common_decisions.py
   def collect_sell_rsi_categories(...) -> Set[str]
   ```

---

## ğŸ“š ì°¸ê³ 

- **ë©”ëª¨ë¦¬:** "ì¶”ì²œ/ë°±í…ŒìŠ¤íŠ¸ ë¡œì§ ì¼ê´€ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸" ì°¸ê³ 
- **ì½”ë“œ:** `logic/recommend/portfolio.py`, `logic/backtest/portfolio_runner.py`
- **ì„¤ì •:** `data/settings/account/k1.json`
