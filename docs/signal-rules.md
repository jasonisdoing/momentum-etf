# 매수·매도 규칙 요약

이 문서는 여러 종목 중에서 목표 수량(N개)을 유지하기 위해 포트폴리오가 어떤 기준으로 종목을 매수·매도하는지 설명합니다. 개발 지식이 없어도 이해할 수 있도록 실제 흐름과 판단 근거만 간결하게 정리했습니다.

---

## 1. 기본 원칙
- **보유 상태 판단**: 주식 계좌는 1주라도 보유하면 ‘보유’, 없으면 ‘대기’로 표시합니다. 코인 계좌는 매우 작은 잔고는 무시하고, 의미 있는 양을 보유했을 때만 ‘보유’로 간주합니다.
- **쿨다운(재매매 대기 기간)**: 최근 지정된 일수 안에 매수한 종목은 그 기간이 끝날 때까지 매도 후보에서 제외합니다. 반대로 최근에 매도한 종목도 같은 기간 동안 매수 후보로 올리지 않아 불필요한 재거래를 막습니다.
- **표시 순서와 안내 문구**: 표에는 매도 관련 항목, 신규 매수, 대기 순으로 나열하며, 같은 그룹 안에서는 점수가 높은 종목이 위에 배치됩니다. 각 상태는 “신규 매수”, “부분 매도”처럼 사람이 읽기 쉬운 문구로 안내합니다.

---

## 2. 매수 규칙

### 2.1 매수 후보 선정
- 모든 종목을 살펴 오늘 상승 추세가 이어지고 있는지 확인합니다. 가격 데이터가 비어 있거나 0이면 제외합니다.
- 최근 매도한 지 얼마 되지 않아 쿨다운에 걸려 있다면 후보에서 제외합니다.
- 후보가 너무 많으면 카테고리(테마)별로 가장 점수가 높은 종목만 남겨 한 분야에 과도하게 집중되는 것을 방지합니다.

### 2.2 신규 편입 (빈 슬롯 채우기)
- 현재 보유하지 않은 종목이 매수 후보에 올랐고, 포트폴리오에 빈 자리가 있을 때 실행합니다.
- 전체 자산을 목표 종목 수로 나눈 금액과 현재 가용 현금 중 더 작은 값을 예산으로 사용해 매수 수량을 결정합니다. 주식은 정수 단위로, 호주 주식·코인은 소수점 단위까지 살 수 있습니다.
- 예산이 모자라면 실제 매수는 하지 않고 “현금 부족” 같은 안내만 표기합니다.

### 2.3 부분 매수 (기존 비중 늘리기)
- 이미 보유 중인 종목을 추가로 매수한 경우 상태는 계속 ‘보유’로 유지하고, “부분 매수” 문구와 함께 추가 매수 금액을 안내합니다.

### 2.4 교체 매수 (좋은 종목으로 갈아타기)
- 포트폴리오가 꽉 찼는데 더 우수한 후보가 나타나면, 같은 카테고리 또는 전체 보유 종목 중 가장 약한 종목과 비교합니다.
- 후보의 점수가 충분히 높으면 기존 종목을 매도 목록에 올리고, 그 매도 금액을 예산으로 삼아 새 종목을 편입합니다. 이때 “○○을(를) 팔고 △△으로 교체”라는 형태로 안내합니다.
- 교체 대상이 최근 매수된 종목이라 쿨다운에 걸리면 교체를 미루고 “쿨다운 ○일 대기 중”이라는 설명만 남깁니다.

### 2.5 시장 위험 회피
- 시장이 급격히 하락하는 구간으로 판단되면 새로 편입하려던 종목의 매수 신호를 모두 꺼 버리고 “시장 위험 회피 중”이라는 경고 문구를 표시합니다.

---

## 3. 매도 규칙

### 3.1 기본 매도 조건
아래 조건을 충족하면 해당 종목을 매도 후보로 분류합니다.

- **손절 기준**: 현재 손실률이 사전에 정한 한도를 넘어섰을 때.
- **추세 이탈**: 가격이 이동평균선 아래로 떨어져 상승 흐름이 꺾였을 때.
- **교체 매도**: 더 나은 후보를 편입하기 위해 기존 종목을 내보내야 할 때. 손실이 발생한 경우 “손실”이라는 표현을 사용합니다.
- **시장 위험 회피**: 시장이 위험하다고 판단되면 보유 종목이라도 매도를 권고합니다.

### 3.2 부분 매도
- 당일 일부만 매도해 잔고가 남아 있으면 상태는 ‘보유’로 유지하며, “부분 매도” 문구와 함께 매도 금액을 안내합니다.

### 3.3 전량 매도
- 거래 후 잔고가 0이 되면 ‘매도 완료’로 표시하고 해당 종목은 포트폴리오에서 제거합니다. 교체 매도로 나가는 경우도 동일하게 처리합니다.

### 3.4 쿨다운 보정
- 최근에 매수한 지 얼마 되지 않은 종목은 위의 매도 조건을 충족하더라도 당장 매도하지 않고 “최근 매수 ○일”이라는 메시지를 보여 주며 대기시킵니다.

---

## 4. 결과 정리 방식
1. 각 종목의 상태와 안내 문구를 표 한 줄로 정리합니다. 상태 열과 메시지는 항상 최신 판단을 반영해야 합니다.
2. 같은 카테고리에서 경쟁한 대기 종목은 가장 점수가 높은 한 종목만 남기고 나머지는 숨깁니다.
3. 표는 매도 항목, 매수 항목, 대기 항목 순으로 정렬하며, 같은 그룹에서는 점수 높은 순·동점이면 종목 코드 순으로 배치합니다.
4. 이렇게 정리된 결과는 슬랙 알림, 로그 파일, 데이터베이스 기록 등에 동일하게 사용됩니다.

---

## 5. 운영 시 주의 사항

- 금액과 수익률은 사용자에게 익숙한 통화 단위와 소수점 자릿수로 맞춰 표기합니다.
- 쿨다운 여부와 당일 체결 내역은 반드시 최신 데이터를 이용해 판단해야 합니다. 누락되면 실행 결과가 달라질 수 있습니다.
- 규칙을 수정하거나 확장할 때는 상태 이름, 안내 문구, 정렬 우선순위가 서로 충돌하지 않는지 함께 검토해야 합니다.

위 절차를 따르면 여러 종목 가운데 어떤 종목을 편입·유지·제거해야 하는지 명확하게 설명하고, 누구나 같은 기준으로 포트폴리오를 운영할 수 있습니다.
