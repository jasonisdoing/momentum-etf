# 전략 로직 상세 (Strategy Logic)

이 문서는 Momentum ETF 시스템의 핵심 매매 알고리즘과 로직을 상세히 설명합니다.

## 1. 5버킷 포트폴리오 할당 (5-Bucket Allocation)

시스템은 자산을 다음 5가지 버킷(Bucket)으로 나누어 배분합니다. 각 버킷은 고유한 역할을 가지며 서로 다른 시장 상황에 대응합니다.

1.  **모멘텀 (Momentum)**: 가장 강한 상승 추세를 보이는 ETF. 공격적인 수익 추구.
2.  **혁신기술 (Innovation)**: 기술주, 성장주 위주의 ETF.
3.  **시장지수 (Market Index)**: S&P500, 나스닥 등 시장 대표 지수. 안정적인 베이스.
4.  **배당방어 (Dividend/Defensive)**: 고배당주, 리츠 등 하락장 방어 및 현금 흐름 창출.
5.  **대체헷지 (Alternative/Hedge)**: 금, 원자재, 채권 등 주식과의 상관관계가 낮은 자산.

### 버킷 내 종목 선정 (Selection)
각 버킷별로 등록된 ETF 후보군 중에서 **MAPS 점수**가 가장 높은 상위 종목(`BUCKET_TOPN`)을 선별하여 투자합니다.

## 2. 추세 분석 알고리즘 (MAPS)

시스템은 각 ETF의 상승 강도를 평가하기 위해 **MAPS (Moving Average Position Score)** 전략을 사용합니다.

### 평가 요소
1.  **이동평균(MA) 위치**: 현재 가격이 이동평균선 위에 있는가? (가장 큰 비중)
2.  **단기 수익률**: 최근 1주, 1달간의 수익률 추이
3.  **연속 상승**: 최근 며칠간 연속으로 상승했는가?

이 요소들을 종합하여 각 ETF에 점수를 부여하며, 점수가 높을수록 상승 추세가 강한 것으로 판단합니다. (점수의 양수/음수 여부와 무관하게 모든 후보 종목의 상대적 순위를 비교하여 매매를 결정합니다.)

## 2. 포지션 상태 및 결정 로직

각 ETF는 매일 다음 중 하나의 상태를 가집니다.

| 상태 | 설명 |
|------|------|
| **WAIT** | 관망. 매수 조건 미충족. |
| **BUY** | 신규 매수. 리밸런싱 날에 버킷 내 Top N에 진입함. |
| **HOLD** | 보유. 다음 리밸런싱 날까지 무조건 보유. |
| **SELL_REPLACE** | 교체 매도. 리밸런싱 날에 Top N에서 밀려나 매도함. |

> **핵심 원칙 (Strict Buy & Hold)**: 한번 매수한 종목은 **다음 리밸런싱 날까지 어떠한 경우에도 매도하지 않습니다.** (손절 없음, 추세 이탈 매도 없음)

## 3. 리밸런싱 규칙 (Periodic Rebalance)

전략의 핵심은 **정해진 주기에만 매매를 수행**하는 것입니다.

### (1) 리밸런싱 주기
*   **QUARTERLY** (분기): 매 분기(3, 6, 9, 12월) 마지막 거래일에만 신규 매수 및 교체 매매를 수행합니다. (현 전략의 표준)
*   **MONTHLY** (월간): 매월 마지막 거래일에 수행 (옵션)

> [!NOTE]
> 백테스트 시작일에는 초기 자산 배분을 위해 즉시 매수가 수행됩니다. 이후에는 설정된 주기의 마지막 거래일에만 매매가 발생합니다.

### (2) 매매 로직 (리밸런싱 날에만 실행)
1.  **매도 (Sell)**: 보유 중인 종목이 해당 버킷의 **점수 상위 N개(Top N)**에서 밀려나면 전량 매도합니다.
2.  **매수 (Buy)**: 해당 버킷의 **점수 상위 N개**에 새로 진입한 종목을 매수합니다.
3.  **유지 (Hold)**: 여전히 Top N 안에 있다면, 점수가 하락하거나 음수가 되어도 **계속 보유**합니다.

> **Why?** 잦은 매매로 인한 손실(Whipsaw)을 방지하고, 추세가 길게 이어지는 종목의 수익을 온전히 향유하기 위함입니다. "빠지면 팔고 오르면 산다"는 식의 잦은 대응보다, **"좋은 놈을 골라 한 분기 동안 묵혀두는"** 전략입니다.

## 4. 매매 가격 및 정합성 (Execution & Consistency)

시스템은 백테스트와 추천 모두 **동일한 시뮬레이션 엔진**을 사용하므로 완벽한 논리적 정합성을 유지합니다.

*   **매수/매도 시점**: 리밸런싱 날의 **다음날 장 시작(Open) 시점**
*   **체결 가격**:
    *   **백테스트**: `다음날 시초가 * (1 + 슬리피지)` 로 계산
    *   **실제 매매**: 사용자는 리밸런싱 알림을 받은 **다음날 아침**에 매매를 수행합니다.

## 5. 파라미터 튜닝 (Top 3 Ensemble)

시장 상황에 맞는 최적의 파라미터를 찾기 위해 백테스트 기반의 튜닝을 수행합니다.

### 주요 파라미터
*   `MA_MONTH`: 이동평균 기간 (예: 3개월~12개월)
*   `BUCKET_TOPN`: 버켓 내 최대 보유 종목 수
*   `REBALANCE_MODE`: 리밸런싱 주기 (`QUARTERLY` 권장)
