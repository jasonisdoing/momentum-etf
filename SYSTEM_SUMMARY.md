# ETF 추천 시스템 요약

## 시스템 개요

ETF의 가격 추세를 분석해 상승세가 강한 종목을 자동 추천합니다.
이동평균선 대비 가격 위치, 최근 수익률, 연속 상승 일수 등을 종합해 점수를 부여하고
상위 종목을 포트폴리오 후보로 제시합니다.

---

## 주요 기능

- **ETF 분석 및 점수화**: 상승 추세 강도 평가
- **자동 추천 및 교체**: 점수가 높은 ETF로 교체 제안
- **시장 위험 감시**: 리스크 신호 발생 시 매수 제한
- **자산 배분 관리**: 현금·보유 비중을 고려한 투자 제안
- **RSI 과매수 감지**: 과열된 종목 매도 및 신규 매수 차단

---

## 후보군 구성 원칙

- `zsettings/stocks/<국가>.json` 에서 **카테고리별 3개월 수익률( `3_month_earn_rate` )이 가장 높은 1개 ETF**만 추려 공통 후보군을 만든다.
- `config.CATEGORY_EXCEPTIONS` 에 정의된 예외 카테고리는 필터링하지 않고 모두 포함한다.
- 각 계좌 설정의 **벤치마크 ETF**는 카테고리와 무관하게 항상 추가한다.
- 추천·백테스트·튜닝·가격 캐시 갱신이 모두 동일한 대표군을 참조해 결과가 일관된다.

---

## 포지션 상태

| 상태 | 의미 |
|------|------|
| WAIT | 대기 상태 |
| BUY | 신규 매수 제안 |
| HOLD | 보유 유지 |
| SELL_TREND | 추세 약화로 매도 제안 |
| SELL_RSI | RSI 과매수로 매도 제안 |
| CUT_STOPLOSS | 손절 지시 |
| BUY_REPLACE | 교체 매수 제안 |
| SELL_REPLACE | 교체 매도 제안 |

---

## 리스크 관리

- **동일 카테고리 중복 방지**: 같은 섹터 ETF 중복 편입 차단 (`config.CATEGORY_EXCEPTIONS` 예외)
- **시장 레짐 모니터링**: 시장 위험 시 신규 매수 차단 또는 투자 비중 축소
- **쿨다운 기간**: 최근 거래 후 일정 기간 동안 재거래 제한
- **RSI 과매수 관리**: 과열된 종목 자동 감지 및 매도
- **데이터 검증**: 가격 데이터 누락 시 거래 중단
- **현금 관리**: 투자 가능 현금 범위 내에서만 매수

---

## 데이터 사용 및 일관성

### 추천/백테스트 데이터 일관성

- **동일한 로직**: 추천과 백테스트가 완전히 동일한 데이터와 로직 사용
- **전날 종가 기준**: 모든 의사결정은 최근 마감된 거래일의 종가 기준
- **재현성 보장**: 같은 날짜, 같은 설정이면 항상 동일한 결과
- **하루 종일 일관성**: 07:00 실행 = 09:00 실행 = 15:00 실행 → 동일한 추천
- **대표군 공유**: 후보군 필터링(카테고리 대표+벤치마크+예외 카테고리 전체)이 모든 실행 경로에서 동일하게 적용됨

### 정보성 실시간 데이터

- **화면 표시용**: 현재가, NAV, 괴리율을 실시간 조회 (네이버/yfinance API)
- **의사결정 무관**: 이 정보는 매매 판단에 영향을 주지 않음
- **참고 목적**: 사용자가 시장 상황을 모니터링하는 용도로만 활용

### 시장 거래 시간표

| 국가 | 개장 | 마감 | 체크 간격 |
|------|------|------|----------|
| 한국 | 09:00 | 16:00 | 20분 |

---

## 시스템의 가치

ETF 추천 시스템은
**"지속적인 상승 추세를 유지하면서 시장 위험을 피하는 종목만 선별"**하는
**반(半)자동 포트폴리오 운용 시스템**입니다.

> 이 시스템은 사용자가 직접 시장을 모니터링하지 않아도,
> 상승 종목 유지 / 교체 / 매도 시점을 자동으로 제시해
> 투자 효율성과 안정성을 동시에 제공합니다.

### 핵심 강점

1. **데이터 기반 의사결정**: 감정이 아닌 수치로 판단
2. **리스크 관리**: 시장 레짐, RSI, 카테고리 중복 등 다층 방어
3. **자동화**: 매일 추천 업데이트, 수동 개입 최소화
4. **투명성**: 모든 판단 근거와 수익률을 명확히 제시
5. **검증 가능성**: 백테스트로 전략 유효성 입증

### 사용 시 유의사항

- 시스템은 **보조 도구**이며, 최종 투자 결정은 사용자의 판단입니다.
- 과거 성과가 미래 수익을 보장하지 않습니다.
- 시장 급변 시 시스템 반응에 시차가 있을 수 있습니다.
- 정기적으로 파라미터를 재튜닝하여 시장 변화에 대응하세요.
