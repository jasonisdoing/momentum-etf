# DEVELOPMENT_RULES.md

## 1. 처리 원칙
1. **병렬 처리 금지**  
    - 모든 데이터와 연산은 **순차적**으로 처리한다.  
    - 멀티스레딩/멀티프로세싱은 사용하지 않는다.  

2. **휴장일 처리**  
    - 휴장일에는 데이터를 생성하지 않는다.  
    - 휴장일에는 종목들의 가격을 새로 조회하지 말고, 마지막 거래일의 가격이 캐시에 있으면 그대로 사용한다.  
    - 휴장일 이후 **다음 거래일 데이터 기준**으로 신호를 생성한다.  

---

## 2. 계산 원칙
1. **평가금액 계산**  
    - 휴장일의 평가금액을 계산할때는 마지막 거래일의 평가금액과 동일하다  

2. **종목 가격**  
    - 종목들의 가격 정보는 data/cache/{country}/*.pkl 파일에 캐시로 저장되고, 데이터가 필요하면 그 증분만큼 가져온다.

3. **평가금액 자동 보정**
    - 보유 종목의 현재가 합이 기록된 평가금액보다 크거나,
    - 평가금액이 0일 경우, 평가금액을 보유 종목 가치 합으로 자동 보정합니다.
    - 이는 현금이 음수로 표시되는 것을 방지하고, 평가금액 미입력 시 초기값을 설정해줍니다.
    - 절대 사용자가 입력하거나, 스케줄러가 입력한 0이 아닌 평가금액을 줄이지 않는다.

---

## 3. 저장 및 기록 원칙
1. **로그 기록**  
    - 주요 이벤트는 모두 파일 로그에 기록한다.  
    - 로그 레벨:  
        - `INFO`: 정상 처리  
        - `WARNING`: 데이터 누락/불완전  
        - `ERROR`: 실행 실패  

---

## 4. 예외 처리 원칙
1. **거래 데이터 부족한 종목**  
    - 계산을 할때 필요한 기간의 거래 데이터가 부족한 경우는 제외한다.
        - 예) "KIWOOM 한국고배당&미국AI테크(0097L0): 데이터 기간이 부족하여 계산에서 제외됩니다."
    - 테스트/튜닝을 할때 필요한 기간의 거래 데이터가 부족한 경우는 해당 종목의 데이터가 있는 구간만 사용한다.

2. **거래 불가능 종목**  
    - 거래 정지, 상장폐지 등 종목은 건너뛰고 로그에 남긴다.  

3. **비정상 데이터**  
    - 음수 가격, 0 거래량 등 비정상 값이 있으면 해당 계산은 진행하지 않고 ERROR로그를 남기고 슬랙에 남긴다

---

## 5. 코드 생성/관리 원칙
1. **AI 코드 생성 시 지침**
    - 함수, 클래스 단위로 모듈화 (1파일 1기능 원칙)
    - 중복 코드 발견 시 리팩터링 제안
    - 사용하지 않는 import, 펑션 모두 제거

## 6. 확장 원칙
1. 새로운 전략이나 지표를 추가할 때는 **본 문서의 규칙을 우선 준수**한다.  
2. 규칙과 충돌하는 새로운 로직이 필요하다면, 반드시 본 문서를 업데이트한 뒤 적용한다.  